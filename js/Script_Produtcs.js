let productos = [
    {
        id: 1,
        nombre: "Aretes Semilla",
        descripcion: "Plata ley 950",
        imagen: "/imagenes/Products/Aretes Semilla.jpg",
        imagenPrincipal: "/imagenes/Products/Aretes Semilla.jpg",
        miniatura1: "/imagenes/Products/aretessemilla1.jpeg",
        miniatura2: "/imagenes/Products/Aretes Semilla.jpg",
        miniatura3: "/imagenes/Products/aretessemilla2.jpeg",
        miniatura4: "/imagenes/Products/Aretes Semilla.jpg",
        precio: 14000,
        talla1: "Única",
        descripcionLarga: "Elegantes aretes elaborados en plata ley 950."
    },
    {
        id: 2,
        nombre: "Candongas Espinas",
        descripcion: "Plata ley 950",
        imagen: "/imagenes/Products/Candongas espinas1.jpg",
        imagenPrincipal: "/imagenes/Products/Candongas_espinas.jpg",
        miniatura1: "/imagenes/Products/Candongas espinas1.jpg",
        miniatura2: "/imagenes/Products/Candongas_espinas.jpg",
        miniatura3: "/imagenes/Products/Candongas espinas1.jpg",
        miniatura4: "/imagenes/Products/Candongas_espinas.jpg",
        precio: 20000,
        talla1: "Única",
        descripcionLarga: "Diseño exclusivo de candongas con textura de espinas, en plata ley 950."
    },
    {
        id: 3,
        nombre: "Candongas Flor",
        descripcion: "Plata ley 950",
        imagen: "/imagenes/Products/Candongas Plata Ley.jpg",
        imagenPrincipal: "/imagenes/Products/Candongas Plata Ley.jpg",
        miniatura1: "/imagenes/Products/candongasflor.jpeg",
        miniatura2: "/imagenes/Products/candongasflor2.jpeg",
        miniatura3: "/imagenes/Products/candongasflor.jpeg",
        miniatura4: "/imagenes/Products/Candongas Plata Ley.jpg",
        precio: 10000,
        talla1: "Única",
        descripcionLarga: "Candongas con diseño floral, elaboradas en plata ley 950."
    },
    {
        id: 4,
        nombre: "Candelabro Cabeza",
        descripcion: "Latón y cobre",
        imagen: "/imagenes/Products/Candelabro cabeza.jpg",
        imagenPrincipal: "/imagenes/Products/Candelabro cabeza.jpg",
        miniatura1: "/imagenes/Products/Candelabro cabeza.jpg",
        miniatura2: "/imagenes/Products/candelabro.jpg",
        miniatura3: "/imagenes/Products/Candelabro cabeza.jpg",
        miniatura4: "/imagenes/Products/candelabro.jpg",
        precio: 100000,
        talla1: "Única",
        descripcionLarga: "Candelabro artesanal hecho de latón y cobre con un diseño único en forma de cabeza."
    },
    {
        id: 5,
        nombre: "Candelabro Mano",
        descripcion: "Latón y cobre",
        imagen: "/imagenes/Products/Candelabro mano.jpg",
        imagenPrincipal: "/imagenes/Products/Candelabro mano.jpg",
        miniatura1: "/imagenes/Products/Candelabro mano.jpg",
        miniatura2: "/imagenes/Products/candelabro.jpg",
        miniatura3: "/imagenes/Products/Candelabro mano.jpg",
        miniatura4: "/imagenes/Products/candelabro.jpg",
        precio: 160000,
        talla1: "Única",
        descripcionLarga: "Candelabro con forma de mano, elaborado en latón y cobre, con un diseño exclusivo."
    },
    {
        id: 6,
        nombre: "Lipcuff Líneas",
        descripcion: "Plata ley 950",
        imagen: "/imagenes/Products/Lipcufflineas.jpeg",
        imagenPrincipal: "/imagenes/Products/Lipcufflineas.jpeg",
        miniatura1: "/imagenes/Products/Lipcufflineas1.jpeg",
        miniatura2: "/imagenes/Products/Lipcufflineas.jpeg",
        miniatura3: "/imagenes/Products/Lipcufflineas2.jpeg",
        miniatura4: "/imagenes/Products/Lipcufflineas.jpeg",
        precio: 75000,
        talla1: "Única",
        descripcionLarga: "Lipcuff con diseño de líneas minimalistas, elaborado en plata ley 950."
    },
    {
        id: 7,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa  (1).png",
        imagenPrincipal: "/imagenes/Products/Camisa  (1).png",
        miniatura1: "/imagenes/Products/Camisa  (5).png",
        miniatura2: "/imagenes/Products/Camisa  (2).png",
        miniatura3: "/imagenes/Products/Camisa  (3).png",
        miniatura4: "/imagenes/Products/Camisa  (4).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño exclusivo, disponible en todas las tallas."
    },
    {
        id: 8,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa  (2).png",
        imagenPrincipal: "/imagenes/Products/Camisa  (2).png",
        miniatura1: "/imagenes/Products/Camisa  (1).png",
        miniatura2: "/imagenes/Products/Camisa  (3).png",
        miniatura3: "/imagenes/Products/Camisa  (4).png",
        miniatura4: "/imagenes/Products/Camisa  (5).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con un patrón vibrante, ideal para cualquier ocasión."
    },
    {
        id: 9,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa  (3).png",
        imagenPrincipal: "/imagenes/Products/Camisa  (3).png",
        miniatura1: "/imagenes/Products/Camisa  (4).png",
        miniatura2: "/imagenes/Products/Camisa  (5).png",
        miniatura3: "/imagenes/Products/Camisa  (6).png",
        miniatura4: "/imagenes/Products/Camisa  (1).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa con un diseño único y estampado colorido."
    },
    {
        id: 10,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa  (4).png",
        imagenPrincipal: "/imagenes/Products/Camisa  (4).png",
        miniatura1: "/imagenes/Products/Camisa  (5).png",
        miniatura2: "/imagenes/Products/Camisa  (6).png",
        miniatura3: "/imagenes/Products/Camisa  (1).png",
        miniatura4: "/imagenes/Products/Camisa  (2).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño innovador, perfecta para el día a día."
    },
    {
        id: 11,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa (5).png",
        imagenPrincipal: "/imagenes/Products/Camisa (5).png",
        miniatura1: "/imagenes/Products/Camisa (6).png",
        miniatura2: "/imagenes/Products/Camisa (1).png",
        miniatura3: "/imagenes/Products/Camisa (2).png",
        miniatura4: "/imagenes/Products/Camisa (3).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño atractivo y disponible en varias tallas."
    },
    {
        id: 12,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "/imagenes/Products/Camisa (6).png",
        imagenPrincipal: "/imagenes/Products/Camisa (6).png",
        miniatura1: "/imagenes/Products/Camisa (1).png",
        miniatura2: "/imagenes/Products/Camisa (2).png",
        miniatura3: "/imagenes/Products/Camisa (3).png",
        miniatura4: "/imagenes/Products/Camisa (4).png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada en tonos modernos y versátil para cualquier ocasión."
    }
];

let carrito = [];

function cargarCarrito() {
    const carritoGuardado = localStorage.getItem("carrito"); 
    carrito = carritoGuardado ? JSON.parse(carritoGuardado) : [];
}

function guardarCarrito(){
    localStorage.setItem("carrito", JSON.stringify(carrito));
}

function renderProductos() {
    const seccionProductos = document.getElementById("seccionProductos");
    seccionProductos.innerHTML = ""; // Limpia la sección antes de agregar nuevos productos

    productos.forEach((producto) => {
        const productoCompleto = document.createElement("div");
        productoCompleto.classList.add("productoCompleto");

        const tarjetaProductos = `
            <article class="tarjetaProductos">
                <div class="imagenProductos">
                    <div class="imagenProductosContenedor">
                        <img src="${producto.imagen}" alt="${producto.nombre}">
                        <div class="imgOverlay">
                            <a href="Item.html?id=${producto.id}">
                                <button class="btnVer">Ver producto</button>
                            </a>
                        </div>
                    </div>
                </div>
            </article>
            <div class="infoProductos">
                <h3>${producto.nombre}</h3>
                <p class="descripcionP">${producto.descripcion}</p>
                <p class="precioProductos">$ ${formatearPrecio(producto.precio)}</p>
            </div>
        `;
        
        productoCompleto.innerHTML = tarjetaProductos; 
        seccionProductos.appendChild(productoCompleto); 
    });
}

function renderItems() {
    const itemContenedor = document.getElementById("itemContenedor");
    itemContenedor.innerHTML = "";

    const urlParams = new URLSearchParams(window.location.search);
    const productoId = parseInt(urlParams.get('id')); // Obtener el ID del producto de la URL con urlParams  
    const productoSeleccionado = productos.find(producto => producto.id === productoId); // Find encuentra el producto específico y si se encuentra el producto se renderiza con un if
    
    if (productoSeleccionado) {
        const contenidoProducto = document.createElement("div");
        contenidoProducto.classList.add("contenidoProducto");
        
        // Función para generar las opciones de talla
        const generarOpcionesTalla = (producto) => {
            if (producto.talla1 === "Unica") {
                return `<option value="${producto.talla1}">${producto.talla1}</option>`;
            }
            
            let opciones = '<option value="">Seleccionar talla</option>';
            if (producto.talla1) opciones += `<option value="${producto.talla1}">${producto.talla1}</option>`;
            if (producto.talla2) opciones += `<option value="${producto.talla2}">${producto.talla2}</option>`;
            if (producto.talla3) opciones += `<option value="${producto.talla3}">${producto.talla3}</option>`;
            return opciones;
        };

        contenidoProducto.innerHTML = `
            <div class="fotosProducto">
                <div class="imagenPrincipal">
                    <img src="${productoSeleccionado.imagenPrincipal}" id="primeraImagen">
                </div>
                <div class="contenedorMiniaturas">
                    <img src="${productoSeleccionado.miniatura1}" class="miniatura active">
                    <img src="${productoSeleccionado.miniatura2}" class="miniatura">
                    <img src="${productoSeleccionado.miniatura3}" class="miniatura">
                    <img src="${productoSeleccionado.miniatura4}" class="miniatura">
                </div>
            </div>

            <div class="detallesProducto">

                <div class="seccionOpciones">
                     <h3>${productoSeleccionado.nombre}</h3>
                <p>$ ${formatearPrecio(productoSeleccionado.precio)}</p>
                <div class="seleccionTalla">
                    <h4>TALLA</h4>
                    <select class="selectorTalla">
                        ${generarOpcionesTalla(productoSeleccionado)}
                    </select>

                <div class="seleccionCantidad">
                    <h4>CANTIDAD:</h4>
                    <div class="controladorCantidad">
                        <button class="btnCantidad" id="disminuye">-</button>
                        <input type="number" value="1" min="1" id="cantidad">
                        <button class="btnCantidad" id="aumenta">+</button>
                    </div>
                </div>
                    <div>
                        <button class="añadirCarro" onclick="agregarAlCarrito(${productoSeleccionado.id})">Añadir</button>
                    </div>
                
                </div>
                <div class="informacionProducto">
                    <h4>DESCRIPCIÓN DEL PRODUCTO</h4>
                    <p>${productoSeleccionado.descripcionLarga}</p>
                </div>
            </div>
        `;
        
    itemContenedor.appendChild(contenidoProducto);
    function inicializarFuncionalidades() {
        // Funcionalidad para la galería de imágenes
        const miniaturas = document.querySelectorAll('.miniatura');
        const primeraImagen = document.getElementById('primeraImagen');

        if (miniaturas && primeraImagen) {
            miniaturas.forEach(thumb => {
                thumb.addEventListener('click', function() {
                    primeraImagen.src = this.src;
                    miniaturas.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Funcionalidad para el selector de cantidad
        const entradaCantidad = document.getElementById('cantidad');
        const botonDisminuir = document.getElementById('disminuye');
        const botonAumentar = document.getElementById('aumenta');

        if (entradaCantidad && botonDisminuir && botonAumentar) {
            botonDisminuir.addEventListener('click', function() {
                const valorActual = parseInt(entradaCantidad.value);
                if (valorActual > 1) {
                    entradaCantidad.value = valorActual - 1;
                }
            });

            botonAumentar.addEventListener('click', function() {
                const valorActual = parseInt(entradaCantidad.value);
                entradaCantidad.value = valorActual + 1;
            });

            entradaCantidad.addEventListener('change', function() {
                if (this.value < 1) {
                    this.value = 1;
                }
            });
        }
    }
    inicializarFuncionalidades();
    }
}

function mostrarModalError(mensaje, tipo = 'error') {
    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modalOverlay';
    
    const contenidoModal = `
        <div class="contenidoModalError">
            <div class="iconoModalError">${tipo === 'error' ? '⚠️' : '+'}</div>
            <p class="textoModalError">${mensaje}</p>
        </div>
    `;
    
    modalOverlay.innerHTML = contenidoModal;
    document.body.appendChild(modalOverlay);
    requestAnimationFrame(() => {
        modalOverlay.classList.add('active');
    });

    setTimeout(() => {
        modalOverlay.classList.add('fade-out');
        setTimeout(() => {
            modalOverlay.remove();
        }, 500);
    }, 2000);
}

function mostrarModal(mensaje, tipo = 'success') {
    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modalOverlay';
    
    const contenidoModal = `
        <div class="contenidoModal">
            <div class="iconoModal">${tipo === 'success' ? '✓' : '+'}</div>
            <p class="textoModal">${mensaje}</p>
        </div>
    `;
    
    modalOverlay.innerHTML = contenidoModal;
    document.body.appendChild(modalOverlay);
    requestAnimationFrame(() => {
        modalOverlay.classList.add('active');
    });

    setTimeout(() => {
        modalOverlay.classList.add('fade-out');
        setTimeout(() => {
            modalOverlay.remove();
        }, 500);
    }, 2000);
}

function mostrarModalAgregado(nombreProducto) {
    mostrarModal(`¡${nombreProducto} ha sido agregado al carrito!`);
}

function mostrarModalProductoExistente(nombreProducto) {
    mostrarModal(`Se ha actualizado la cantidad de ${nombreProducto} en el carrito`);
}

function agregarAlCarrito(productoId) {
    const cantidadIngreso = document.getElementById('cantidad');
    const cantidad = parseInt(cantidadIngreso.value);
    const selectorTalla = document.querySelector(".selectorTalla");
    const tallaSeleccionada = selectorTalla.value;

    if (!tallaSeleccionada) {
        mostrarModalError("Por favor, selecciona una talla antes de añadir al carrito.");
        return;
    }
    
    const producto = productos.find((p) => p.id === productoId);
    if (producto) {
        const productoEnCarrito = {
            id: producto.id,
            nombre: producto.nombre,
            precio: producto.precio,
            imagen: producto.imagen,
            cantidad: cantidad,
            talla: tallaSeleccionada,
        };

        // Se llama a la función del carrito

        if (typeof agregarProductoAlCarrito === "function") {
            agregarProductoAlCarrito(productoEnCarrito);
        }

        mostrarModalAgregado(producto.nombre);
    }
    
}

function formatearPrecio(precio) {
    return precio.toLocaleString("es-CO", {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    });
}

document.addEventListener("DOMContentLoaded", () => {
    const paginaActual = window.location.pathname;
    if (paginaActual.includes("Productos.html")) {
        renderProductos();
    }    
    if (paginaActual.includes("Item.html")) {
        renderItems();
    }
    cargarCarrito();
});


