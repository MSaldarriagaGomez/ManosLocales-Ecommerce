let productos = [
    {
        id: 1,
        nombre: "Aretes Semilla",
        descripcion: "Plata ley 950",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611428/Aretes_Semilla_sm1w8u.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611428/Aretes_Semilla_sm1w8u.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611428/aretessemilla2_eulo3b.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611428/Aretes_Semilla_sm1w8u.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611428/aretessemilla2_eulo3b.jpg",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/aretessemilla1_xmzszb.jpg",
        precio: 14000,
        talla1: "Única",
        descripcionLarga: "Elegantes aretes elaborados en plata ley 950."
    },
    {
        id: 2,
        nombre: "Candongas Espinas",
        descripcion: "Plata ley 950",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_espinas_ecsswe.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_espinas_ecsswe.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candongas_espinas1_bqh6ar.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_espinas_ecsswe.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candongas_espinas1_bqh6ar.jpg",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_espinas_ecsswe.jpg",
        precio: 20000,
        talla1: "Única",
        descripcionLarga: "Diseño exclusivo de candongas con textura de espinas, en plata ley 950."
    },
    {
        id: 3,
        nombre: "Candongas Flor",
        descripcion: "Plata ley 950",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_Plata_Ley_vlmzuc.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/Candongas_Plata_Ley_vlmzuc.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/candongasflor_u0aswn.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611440/candongasflor2_lypjec.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611431/candongasflor_u0aswn.jpg",
        miniatura4: "/imagenes/Products/Candongas Plata Ley.jpg",
        precio: 10000,
        talla1: "Única",
        descripcionLarga: "Candongas con diseño floral, elaboradas en plata ley 950."
    },
    {
        id: 4,
        nombre: "Candelabro Cabeza",
        descripcion: "Latón y cobre",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_cabeza_dlrg3m.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_cabeza_dlrg3m.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_cabeza_dlrg3m.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/candelabro_w40iwb.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_cabeza_dlrg3m.jpg",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/candelabro_w40iwb.jpg",
        precio: 100000,
        talla1: "Única",
        descripcionLarga: "Candelabro artesanal hecho de latón y cobre con un diseño único en forma de cabeza."
    },
    {
        id: 5,
        nombre: "Candelabro Mano",
        descripcion: "Latón y cobre",
        imagen: "/imagenes/Products/Candelabro mano.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_mano_mtg5nx.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_mano_mtg5nx.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/candelabro_w40iwb.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Candelabro_mano_mtg5nx.jpg",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/candelabro_w40iwb.jpg",
        precio: 160000,
        talla1: "Única",
        descripcionLarga: "Candelabro con forma de mano, elaborado en latón y cobre, con un diseño exclusivo."
    },
    {
        id: 6,
        nombre: "Lipcuff Líneas",
        descripcion: "Plata ley 950",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611452/Lipcufflineas_cjjcbv.jpg",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611452/Lipcufflineas_cjjcbv.jpg",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611488/lipcuffside_mpqthl.jpg",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611464/Lipcufflineas1_edmi85.jpg",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611476/Lipcufflineas2_vmcx68.jpg",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611464/Lipcufflineas1_edmi85.jpg",
        precio: 75000,
        talla1: "Única",
        descripcionLarga: "Lipcuff con diseño de líneas minimalistas, elaborado en plata ley 950."
    },
    {
        id: 7,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_1_gityj0.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño exclusivo, disponible en todas las tallas."
    },
    {
        id: 8,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_2_cbjkma.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con un patrón vibrante, ideal para cualquier ocasión."
    },
    {
        id: 9,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_3_wn0bwy.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa con un diseño único y estampado colorido."
    },
    {
        id: 10,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_4_bfw737.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño innovador, perfecta para el día a día."
    },
    {
        id: 11,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611429/Camisa_5_dzpuow.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada con diseño atractivo y disponible en varias tallas."
    },
    {
        id: 12,
        nombre: "Camisa Estampada",
        descripcion: "Disponible en todas las tallas",
        imagen: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        imagenPrincipal: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        miniatura1: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        miniatura2: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        miniatura3: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        miniatura4: "https://res.cloudinary.com/dmljqigr5/image/upload/v1738611430/Camisa_6_gwcy0x.png",
        precio: 80000,
        talla1: "S",
        talla2: "M",
        talla3: "L",
        descripcionLarga: "Camisa estampada en tonos modernos y versátil para cualquier ocasión."
    }
];

let carrito = [];

function cargarCarrito() {
    const carritoGuardado = localStorage.getItem(carrito);
    carrito = carritoGuardado ? JSON.parse(carritoGuardado) : [];
}

function guardarCarrito(){
    localStorage.setItem("carrito", JSON.stringify(carrito));
}

function renderProductos() {
    const seccionProductos = document.getElementById("seccionProductos");
    seccionProductos.innerHTML = ""; // Limpia la sección antes de agregar nuevos productos

    productos.forEach((producto) => {
        const productoCompleto = document.createElement("div");
        productoCompleto.classList.add("productoCompleto");

        const tarjetaProductos = `
            <article class="tarjetaProductos">
                <div class="imagenProductos">
                    <div class="imagenProductosContenedor">
                        <img src="${producto.imagen}" alt="${producto.nombre}">
                        <div class="imgOverlay">
                            <a href="Item.html?id=${producto.id}">
                                <button class="btnVer">Ver</button>
                            </a>      
                            <button class="btnAnadir" onclick="agregarAlCarrito(${producto.id})">Añadir</button>
                        </div>
                    </div>
                </div>
            </article>
            <div class="infoProductos">
                <h3>${producto.nombre}</h3>
                <p class="descripcionP">${producto.descripcion}</p>
                <p class="precioProductos">$ ${formatearPrecio(producto.precio)}</p>
            </div>
        `;
        
        productoCompleto.innerHTML = tarjetaProductos; 
        seccionProductos.appendChild(productoCompleto); 
    });

    document.querySelectorAll(".btnAnadir").forEach(boton => {
        boton.addEventListener("click", agregarAlCarrito);
    });
    
}

function renderItems() {
    const itemContenedor = document.getElementById("itemContenedor");
    itemContenedor.innerHTML = "";

    const urlParams = new URLSearchParams(window.location.search);
    const productoId = parseInt(urlParams.get('id')); // Obtener el ID del producto de la URL con urlParams  
    const productoSeleccionado = productos.find(producto => producto.id === productoId); // Find encuentra el producto específico y si se encuentra el producto se renderiza con un if
    
    if (productoSeleccionado) {
        const contenidoProducto = document.createElement("div");
        contenidoProducto.classList.add("contenidoProducto");
        
        // Función para generar las opciones de talla
        const generarOpcionesTalla = (producto) => {
            if (producto.talla1 === "Unica") {
                return `<option value="${producto.talla1}">${producto.talla1}</option>`;
            }
            
            let opciones = '<option value="">Seleccionar talla</option>';
            if (producto.talla1) opciones += `<option value="${producto.talla1}">${producto.talla1}</option>`;
            if (producto.talla2) opciones += `<option value="${producto.talla2}">${producto.talla2}</option>`;
            if (producto.talla3) opciones += `<option value="${producto.talla3}">${producto.talla3}</option>`;
            return opciones;
        };

        contenidoProducto.innerHTML = `
            <div class="fotosProducto">
                <div class="imagenPrincipal">
                    <img src="${productoSeleccionado.imagenPrincipal}" id="primeraImagen">
                </div>
                <div class="contenedorMiniaturas">
                    <img src="${productoSeleccionado.miniatura1}" class="miniatura active">
                    <img src="${productoSeleccionado.miniatura2}" class="miniatura">
                    <img src="${productoSeleccionado.miniatura3}" class="miniatura">
                    <img src="${productoSeleccionado.miniatura4}" class="miniatura">
                </div>
            </div>

            <div class="detallesProducto">

                <div class="seccionOpciones">
                     <h3>${productoSeleccionado.nombre}</h3>
                <p>$ ${formatearPrecio(productoSeleccionado.precio)}</p>
                <div class="seleccionTalla">
                    <h4>TALLA</h4>
                    <select class="selectorTalla">
                        ${generarOpcionesTalla(productoSeleccionado)}
                    </select>

                <div class="seleccionCantidad">
                    <h4>CANTIDAD:</h4>
                    <div class="controladorCantidad">
                        <button class="btnCantidad" id="disminuye">-</button>
                        <input type="number" value="1" min="1" id="cantidad">
                        <button class="btnCantidad" id="aumenta">+</button>
                    </div>
                </div>
                    <div>
                        <button class="añadirCarro" onclick="agregarAlCarrito(${productoSeleccionado.id})">Añadir</button>
                    </div>
                
                </div>
                <div class="informacionProducto">
                    <h4>DESCRIPCIÓN DEL PRODUCTO</h4>
                    <p>${productoSeleccionado.descripcionLarga}</p>
                </div>
            </div>
        `;
        
    itemContenedor.appendChild(contenidoProducto);
    function inicializarFuncionalidades() {
        // Funcionalidad para la galería de imágenes
        const miniaturas = document.querySelectorAll('.miniatura');
        const primeraImagen = document.getElementById('primeraImagen');

        if (miniaturas && primeraImagen) {
            miniaturas.forEach(thumb => {
                thumb.addEventListener('click', function() {
                    primeraImagen.src = this.src;
                    miniaturas.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Funcionalidad para el selector de cantidad
        const entradaCantidad = document.getElementById('cantidad');
        const botonDisminuir = document.getElementById('disminuye');
        const botonAumentar = document.getElementById('aumenta');

        if (entradaCantidad && botonDisminuir && botonAumentar) {
            botonDisminuir.addEventListener('click', function() {
                const valorActual = parseInt(entradaCantidad.value);
                if (valorActual > 1) {
                    entradaCantidad.value = valorActual - 1;
                }
            });

            botonAumentar.addEventListener('click', function() {
                const valorActual = parseInt(entradaCantidad.value);
                entradaCantidad.value = valorActual + 1;
            });

            entradaCantidad.addEventListener('change', function() {
                if (this.value < 1) {
                    this.value = 1;
                }
            });
        }
    }
    inicializarFuncionalidades();
    } else {
        itemContenedor.innerHTML = "<p>Producto no encontrado</p>";
    }
    document.querySelectorAll(".btnAnadir").forEach(boton => {
        boton.addEventListener("click", agregarAlCarrito);
    });
    
}

function mostrarError(mensaje) {
    const errorSpan = document.querySelector('.errorTalla') || document.createElement('span');
    errorSpan.className = 'errorTalla';
    errorSpan.textContent = mensaje;    
   
    const selectorTalla = document.getElementById("selectorTalla");
    if (!document.querySelector('.error-talla')) {
        selectorTalla.parentNode.insertBefore(errorSpan, selectorTalla.nextSibling);
    }
    
    setTimeout(() => {
        errorSpan.remove();
    }, 3000);
}

function mostrarModal(mensaje, tipo = 'success') {
    const modalOverlay = document.createElement('div');
    modalOverlay.className = 'modalOverlay';
    
    const contenidoModal = `
        <div class="contenidoModal">
            <div class="iconoModal">${tipo === 'success' ? '✓' : '+'}</div>
            <p class="textoModal">${mensaje}</p>
        </div>
    `;
    
    modalOverlay.innerHTML = contenidoModal;
    document.body.appendChild(modalOverlay);
    requestAnimationFrame(() => {
        modalOverlay.classList.add('active');
    });

    setTimeout(() => {
        modalOverlay.classList.add('fade-out');
        setTimeout(() => {
            modalOverlay.remove();
        }, 500);
    }, 2000);
}

function mostrarModalAgregado(nombreProducto) {
    mostrarModal(`¡${nombreProducto} ha sido agregado al carrito!`);
}

function mostrarModalProductoExistente(nombreProducto) {
    mostrarModal(`Se ha actualizado la cantidad de ${nombreProducto} en el carrito`);
}

function agregarAlCarrito(productoId) {
    const selectorTalla = document.getElementById("selectorTalla");
    if (!selectorTalla.value) {
        mostrarError("Por favor, selecciona una talla antes de añadir al carrito.");
        return;
    }
    
    const productoEnCarrito = carrito.find((p) => p.id === productoId);
    if (productoEnCarrito) {
        productoEnCarrito.cantidad += 1;
        mostrarModalProductoExistente(productoEnCarrito.nombre);
    } else {
        const producto = productos.find((p) => p.id === productoId);
        if (producto) {
            producto.cantidad = 1;
            producto.talla = selectorTalla.value;
            carrito.push(producto);
            mostrarModalAgregado(producto.nombre);
        }
    }
    guardarCarrito();
}

function formatearPrecio(precio) {
    return precio.toLocaleString("es-CO", {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    });
}

document.addEventListener("DOMContentLoaded", () => {
    const paginaActual = window.location.pathname;
    if (paginaActual.includes("Productos.html")) {
        renderProductos();
    }    
    if (paginaActual.includes("Item.html")) {
        renderItems();
    }
    cargarCarrito();
});


